<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HaulPro — Dashboard</title>
    <link rel="stylesheet" href="dashboad_style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <style>
      #map {
        width: 100%;
        height: 600px;
        border: 0;
      }
      .traffic-toggle {
        margin: 10px 0;
        padding: 8px 15px;
        border: none;
        background: #007bff;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
        border-radius: 5px;
      }
      .traffic-toggle:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <aside class="sidebar" id="sidebar">
        <img src="Image/Logo.png" alt="HaulPro Logo" width="160" />
        <h3>HaulPro</h3>
        <ul class="menu">
          <li class="active">
            <a href="#"><img src="Image/dashboard.png" alt="" />Dashboard</a>
          </li>
          <li>
            <a href="#"
              ><img
                src="Image/chart.png"
                alt=""
                style="width: 40px"
              />Analytics</a
            >
          </li>
          <li>
            <a href="#"
              ><img src="Image/car.png" alt="" style="width: 40px" />Vehicle</a
            >
          </li>
          <li>
            <a href="#"
              ><img src="Image/plus.png" alt="" style="width: 40px" />Add
              Trips</a
            >
          </li>
          <li>
            <a href="#"
              ><img src="Image/wallet.png" alt="" style="width: 40px" />Payment
              Method</a
            >
          </li>
          <li>
            <a href="Lorry_owner.php"
              ><img
                src="Image/businessman.png"
                alt=""
                style="width: 40px"
              />Lorry Owner List</a
            >
          </li>
          <li>
            <a href="lorrylist.php"
              ><img src="Image/truck.png" alt="" style="width: 40px" />Lorry
              List</a
            >
          </li>
          <li>
            <a href="#"
              ><img
                src="Image/settings.png"
                alt=""
                style="width: 40px"
              />Settings</a
            >
          </li>
          <li>
            <a href="#"
              ><img src="Image/faq.png" alt="" style="width: 40px" />FAQ</a
            >
          </li>
        </ul>
        <div class="help-card">
          <img
            src="https://cdn-icons-png.flaticon.com/512/4712/4712002.png"
            alt="Help"
          />
          <p>Need Help?</p>
          <button>Contact Now</button>
        </div>
      </aside>

      <main class="dashboard" id="dashboard">
        <div class="header">
          <h1>Dashboard</h1>
          <div class="header-buttons">
            <button>Click To Check Payout</button>
            <button>Click To Get Earning Report</button>
          </div>
        </div>

        <div class="cards-grid">
          <div class="card">
            <p>Total State</p>
            <h2>30</h2>
          </div>
          <div class="card">
            <p>Total Transporter</p>
            <h2>98</h2>
          </div>
          <div class="card">
            <p>Total Lorry</p>
            <h2>40</h2>
          </div>
          <div class="card">
            <p>Pages</p>
            <h2>3</h2>
          </div>
          <div class="card">
            <p>Total Pending Load</p>
            <h2>186</h2>
          </div>
          <div class="card">
            <p>Total Accepted Load</p>
            <h2>3</h2>
          </div>
          <div class="card">
            <p>Total Pick Up Load</p>
            <h2>3</h2>
          </div>
          <div class="card">
            <p>Total Completed Load</p>
            <h2>43</h2>
          </div>
          <div class="card">
            <p>Total Cancelled Load</p>
            <h2>7</h2>
          </div>
          <div class="card">
            <p>Total Earning (This Week)</p>
            <h2>12500.00৳</h2>
          </div>
          <div class="card">
            <p>Total Pending Payout (This Week)</p>
            <h2>5000.0৳</h2>
          </div>
          <div class="card">
            <p>Total Completed Payout (This Week)</p>
            <h2>35000.0৳</h2>
          </div>
        </div>

        <div class="main-content">
          <div class="map-container">
            <h3 class="map-heading">Live GPS Tracking</h3>
            <button class="traffic-toggle" onclick="toggleTraffic()">
              Toggle Traffic Layer
            </button>
            <div id="map"></div>
          </div>
        </div>
      </main>
    </div>

    <footer>
      <div class="footer-content">
        <p>&copy; 2025 HaulPro. All Rights Reserved.</p>
        <div class="footer-links">
          <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a>
        </div>
      </div>
    </footer>

    <script>
      let map,
        directionsService,
        trafficLayer,
        trafficVisible = true;
      let myLocation = null;
      let activeRenderer = null; // Only one route at a time
      let activeVehicle = null; // Track active vehicle

      function initMap() {
        const defaultLocation = { lat: 23.8103, lng: 90.4125 }; // Dhaka fallback

        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12,
          center: defaultLocation,
        });

        directionsService = new google.maps.DirectionsService();

        // Initialize traffic layer
        trafficLayer = new google.maps.TrafficLayer();
        trafficLayer.setMap(map);

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              myLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };

              new google.maps.Marker({
                position: myLocation,
                map: map,
                title: "You (Position A)",
                icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
              });

              map.setCenter(myLocation);

              // Example 6 vehicles in Dhaka
              const vehicles = [
                { id: "V1", position: { lat: 23.8201, lng: 90.4152 } },
                { id: "V2", position: { lat: 23.7955, lng: 90.3537 } },
                { id: "V3", position: { lat: 23.8324, lng: 90.4228 } },
                { id: "V4", position: { lat: 23.8124, lng: 90.428 } },
                { id: "V5", position: { lat: 23.805, lng: 90.39 } },
                { id: "V6", position: { lat: 23.8255, lng: 90.4005 } },
              ];

              addVehicleMarkers(vehicles);
            },
            () => {
              alert("Geolocation failed. Using default center.");
            }
          );
        }
      }

      function addVehicleMarkers(vehicles) {
        vehicles.forEach((vehicle) => {
          const marker = new google.maps.Marker({
            position: vehicle.position,
            map: map,
            title: vehicle.id,
            icon: "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
          });

          // Toggle route on marker click
          marker.addListener("click", () => {
            toggleRoute(vehicle.id, vehicle.position);
          });
        });
      }

      function toggleRoute(vehicleId, vehiclePos) {
        if (!myLocation) {
          alert("Your location is not available yet.");
          return;
        }

        if (activeVehicle === vehicleId) {
          // Same vehicle clicked again → remove route
          if (activeRenderer) {
            activeRenderer.setMap(null);
            activeRenderer = null;
            activeVehicle = null;
          }
        } else {
          // Clear existing route
          if (activeRenderer) {
            activeRenderer.setMap(null);
          }

          // Draw new bold purple route
          const directionsRenderer = new google.maps.DirectionsRenderer({
            map: map,
            suppressMarkers: false,
            polylineOptions: {
              strokeColor: "#800080", // Purple
              strokeOpacity: 1.0,
              strokeWeight: 7,
            },
          });

          directionsService.route(
            {
              origin: myLocation,
              destination: vehiclePos,
              travelMode: google.maps.TravelMode.DRIVING,
            },
            (response, status) => {
              if (status === "OK") {
                directionsRenderer.setDirections(response);
                activeRenderer = directionsRenderer;
                activeVehicle = vehicleId;
              } else {
                alert("Directions request failed due to " + status);
              }
            }
          );
        }
      }

      // Toggle traffic layer
      function toggleTraffic() {
        if (trafficVisible) {
          trafficLayer.setMap(null);
        } else {
          trafficLayer.setMap(map);
        }
        trafficVisible = !trafficVisible;
      }
    </script>

    <!-- Load Google Maps JS API -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9OwltS3fiIj-fEbmKAPcYH39lj-mOZmM&callback=initMap"
      async
      defer
    ></script>
  </body>
</html>
